\subsection{Surface Of Revolution}

Consider a point $x$ on a $3$-surface $U$ that is a surface of revolution and a vector $v$ in the tangent space $U_x$.

Consider the component $v_0$ of $v$ along $S^2$.

Consider the great circle made by extending $x$ to a geodesic in the direction of $v_0$.

We can reflect across this great circle on all the spherical cross-sections of $U$.

By symmetry, the geodesic made by extending $x$ in the $v$ direction must stay on this slice of $U$.

This reduces finding the geodesic on a $3$-surface of revolution to finding one on a $2$-surface.

\bigskip

\subsubsection{Finding the vectors from a point:}

\bigskip

Rather than mapping a sphere to $\mathbb{R}^2$, we can embed it in $\mathbb{R}^3$.

Given points $\textbf{x}, \textbf{y} \in S^2 \times \mathbb{R}$,

Let $\textbf{v} =$ the normalization of the projection of $\textbf{y}_1$ perpendicular to $\textbf{x}_1$.

Let $\theta =$ the angle between $\textbf{x}$ and $\textbf{y} = \arccos\left<\textbf{x},\textbf{y}\right>$

Now we take the points $\textbf{x}' = (0,x_4)$ and $\textbf{y}' = (\theta, y_4)$ in the two-dimensional version.

Let $\textbf{z}'$ be a vector between them.

Let the $S^2$ component of $\textbf{z}$ be $z'_0\textbf{v}$ and the $\textbf{R}$ component be $z'_1$.

$\textbf{z}$ is a vector between the two points.

\bigskip

\subsubsection{Finding a point from a vector:}

\bigskip

Given point $\textbf{x}$ and vector $\textbf{z}$,

Let $\textbf{x}' = (0,x_2), \textbf{z}' = (\|\textbf{z}_1\|,z_2)$.

Let $\textbf{v} = \|\textbf{z}_1\|$.

Find $\textbf{y}'$ with the two-dimensional version.

$\textbf{y} = (\textbf{x}_1\cos y'_1+\textbf{v}\sin y'_1, y'_2)$.

In order to find the rotation, we must work in a more relevant basis. We can do this by commuting with the appropriate matrix.

$\textbf{e}_1 \mapsto \textbf{e}_1, \textbf{v} \mapsto \textbf{e}_2, \textbf{x}_1 \mapsto \textbf{e}_3, \textbf{x}_1 \times \textbf{v} \mapsto \textbf{e}_4$

$(\textbf{e}_1, \textbf{v},\textbf{x}_1,(\textbf{x}_1 \times \textbf{v}))^{-1}$

$= (\textbf{e}_1, \textbf{v},\textbf{x}_1,(\textbf{x}_1 \times \textbf{v}))^T$, since it's a rotation matrix.

First, we use the rotation of the two-dimensional version to find the rotation between $\textbf{e}_1$ and $\textbf{v}$.

%$\mat{\cos\theta}{-\sin\theta}{\sin\theta}{\cos\theta}$

$\left(\begin{array}{cccc} \cos\theta & -\sin\theta & 0 & 0 \\ \sin\theta & \cos\theta & 0 & 0 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{array} \right)$

Next, we have to deal with the fact that the $S^2$ component rotates.

Let $\phi = y'_2-x'_2$.

$$\left(\begin{array}{cccc} 1 & 0 & 0 & 0 \\ 0 & \cos\phi & -\sin\phi & 0 \\ 0 & \sin\phi & \cos\phi & 0 \\ 0 & 0 & 0 & 1 \end{array} \right)$$

Putting this all together, we get:

$$(\textbf{e}_1,\textbf{z},\textbf{x},(\textbf{x} \times \textbf{z}))
\left(\begin{array}{cccc} 1 & 0 & 0 & 0 \\ 0 & \cos\phi & -\sin\phi & 0 \\ 0 & \sin\phi & \cos\phi & 0 \\ 0 & 0 & 0 & 1 \end{array} \right)
\left(\begin{array}{cccc} 1 & 0 & 0 & 0 \\ 0 & \cos\phi & -\sin\phi & 0 \\ 0 & \sin\phi & \cos\phi & 0 \\ 0 & 0 & 0 & 1 \end{array} \right)
(\textbf{e}_1,\textbf{z},\textbf{x},(\textbf{x} \times \textbf{z}))^T$$

\bigskip

\subsubsection{Portals:}

The intersection tells me the orientation as embedded in $\mathbb{R}^3$. I need to convert that to $\mathbb{R} \times S^2 \subseteq \mathbb{R}^4$.

First, I just expand the matrix $M$ to $\mat{M}{0}{0}{1}$ to put it in $\mathbb{R}^3 \subseteq \mathbb{R}^4$.

Now I need to reflect it twice.

First, I will reflect along the $t$-axis, to get $\mat{M}{0}{0}{-1}$. This doesn't change anything, since that vector was orthogonal to reality, but it does guarantee that the final orientation will have the same sign.

Now I need to reflect between $(1,0,0,0)$ and $(0,v)$ where $v \in S^2$ is the position of the vector.

Let $w$ be a vector I am moving with this, and $R$ be the reflection matrix.

$Rw = w - ((v,0)-(0,0,0,1))\left<(v,0)-(0,0,0,1),w\right>$

$= w - (v,-1)\left<(v,-1),w\right>$

$= Iw - (v,-1)(v,-1)^Tw$

$= (I - (v,-1)(v,-1)^T)w$

$R = I - (v,-1)(v,-1)^T$

This means that the final orientation is $R\mat{M}{0}{0}{-1}$.

???

Let $\textbf{w}$ be the direction you're moving from your own point of reference.

$M\textbf{w}$ is the direction you'd end up going in Euclidean geometry.

In the surface of revolution, the program pads a $0$ at the end, signifying that you are not moving at all perpendicular to reality. This means the direction from your point of reference is $(\textbf{w},0)$.

If you're lucky enough that $M\textbf{w}$ is tangent to the portal, then you only have to deal with changing coordinates, and the direction you'll end up going is $(0,M\textbf{w})$.

Thus, you can think of it as $(\textbf{w},0) \mapsto (0,M\textbf{w}), (\textbf{0},1) \mapsto (1,\textbf{0})$, which is represented by the linear transformation $\mat{\textbf{0}^T}{1}{M}{\textbf{0}}$.

If $M\textbf{w}$ is perpendicular to the portal, $(w,0)$ should move to $(\|w\|,\textbf{0})$. The previous transformation sends it to $(0,M\textbf{w})$ instead. We need to reflect between these two, while preserving anything perpendicular to them.

Assuming for simplicity that $M\textbf{w}$ is unit. Since we're looking at a unit vector perpendicular to the portal, we've already narrowed it down to a specific vector, so we can just call it $\textbf{v}$. We need to reflect between $(1,\textbf{0})$ and $(0,\textbf{v})$.

This gives $R = I - (-1,\textbf{v})(-1,\textbf{v})^T$.

Thus, the final matrix is $R\mat{\textbf{0}^T}{1}{M}{\textbf{0}}$.